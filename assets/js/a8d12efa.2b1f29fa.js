"use strict";(self.webpackChunknestjs_cls_docs=self.webpackChunknestjs_cls_docs||[]).push([[7213],{6873:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>l,frontMatter:()=>a,metadata:()=>t,toc:()=>u});const t=JSON.parse('{"id":"features-and-use-cases/usage-outside-of-web-request","title":"Usage outside of web request","description":"Sometimes, a part of the app that relies on the CLS storage might need to be called outside of the context of a web request - for example, in a Cron job, while consuming a Queue, during the application bootstrap or in CLI apps.","source":"@site/docs/03_features-and-use-cases/04_usage-outside-of-web-request.md","sourceDirName":"03_features-and-use-cases","slug":"/features-and-use-cases/usage-outside-of-web-request","permalink":"/nestjs-cls/features-and-use-cases/usage-outside-of-web-request","draft":false,"unlisted":false,"editUrl":"https://github.com/Papooch/nestjs-cls/tree/main/docs/docs/03_features-and-use-cases/04_usage-outside-of-web-request.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{},"sidebar":"documentationSidebar","previous":{"title":"Breaking out of DI","permalink":"/nestjs-cls/features-and-use-cases/breaking-out-of-di"},"next":{"title":"Type safety and type inference","permalink":"/nestjs-cls/features-and-use-cases/type-safety-and-type-inference"}}');var o=n(2540),r=n(3023);const a={},i="Usage outside of web request",c={},u=[];function d(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"usage-outside-of-web-request",children:"Usage outside of web request"})}),"\n",(0,o.jsx)(s.p,{children:"Sometimes, a part of the app that relies on the CLS storage might need to be called outside of the context of a web request - for example, in a Cron job, while consuming a Queue, during the application bootstrap or in CLI apps."}),"\n",(0,o.jsx)(s.p,{children:"In such cases, there are no enhancers that can be bound to the handler to set up the context."}),"\n",(0,o.jsxs)(s.p,{children:["Therefore, you as the the developer are responsible for wrapping the execution with ",(0,o.jsx)(s.code,{children:"ClsService#run"}),", or using ",(0,o.jsxs)(s.a,{href:"/nestjs-cls/setting-up-cls-context/using-a-decorator",children:["the ",(0,o.jsx)(s.code,{children:"@UseCls"})," decorator"]}),". In any case, if any following code depends on some context variables, these need to be set up manually."]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-ts",children:"@Injectable()\nexport class CronController {\n    constructor(\n        private readonly someService: SomeService,\n        private readonly cls: ClsService,\n    );\n\n    @Cron('45 * * * * *')\n    async handleCronExample1() {\n        // either explicitly wrap the function body with\n        // a call to `ClsService#run` ...\n        await this.cls.run(async () => {\n            this.cls.set('mode', 'cron');\n            await this.someService.doTheThing();\n        });\n    }\n\n    @Cron('90 * * * * *')\n    // ... or use the convenience decorator which\n    // does the wrapping for you seamlessly.\n    @UseCls({\n        setup(cls) {\n            cls.set('mode', 'cron');\n        },\n    })\n    async handleCronExample2() {\n        await this.someService.doTheThing();\n    }\n}\n"})}),"\n",(0,o.jsx)(s.admonition,{type:"caution",children:(0,o.jsxs)(s.p,{children:["Special care must be taken in case you're using ",(0,o.jsx)(s.a,{href:"/nestjs-cls/features-and-use-cases/proxy-providers#outside-web-request",children:"Proxy Providers"}),"."]})})]})}function l(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},3023:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>i});var t=n(3696);const o={},r=t.createContext(o);function a(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);