"use strict";(self.webpackChunknestjs_cls_docs=self.webpackChunknestjs_cls_docs||[]).push([[578],{1805:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>a,frontMatter:()=>t,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"api/module-options","title":"Module Options","description":"forRoot(Async)","source":"@site/docs/04_api/02_module-options.md","sourceDirName":"04_api","slug":"/api/module-options","permalink":"/nestjs-cls/api/module-options","draft":false,"unlisted":false,"editUrl":"https://github.com/Papooch/nestjs-cls/tree/main/docs/docs/04_api/02_module-options.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"documentationSidebar","previous":{"title":"Service Interface","permalink":"/nestjs-cls/api/service-interface"},"next":{"title":"Considerations","permalink":"/nestjs-cls/considerations/"}}');var o=s(2540),i=s(3023);const t={},c="Module Options",d={},l=[{value:"forRoot(Async)",id:"forrootasync",level:2},{value:"forFeature(Async)",id:"forfeatureasync",level:2},{value:"Middleware &amp; Enhancer options",id:"middleware--enhancer-options",level:2}];function h(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"module-options",children:"Module Options"})}),"\n",(0,o.jsx)(n.h2,{id:"forrootasync",children:"forRoot(Async)"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"ClsModule.forRoot()"})," method takes the following ",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"ClsModuleOptions"})}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"middleware?:"})})}),(0,o.jsx)(n.code,{children:"ClsMiddlewareOptions"}),(0,o.jsx)(n.br,{}),"\n","An object with additional options for the ",(0,o.jsx)(n.code,{children:"ClsMiddleware"}),", see ",(0,o.jsx)(n.a,{href:"#middleware--enhancer-options",children:"below"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"guard?:"})})}),(0,o.jsx)(n.code,{children:"ClsGuardOptions"}),(0,o.jsx)(n.br,{}),"\n","An object with additional options for the ",(0,o.jsx)(n.code,{children:"ClsGuard"}),", see ",(0,o.jsx)(n.a,{href:"#middleware--enhancer-options",children:"below"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"interceptor?:"})})}),(0,o.jsx)(n.code,{children:"ClsInterceptorOptions"}),(0,o.jsx)(n.br,{}),"\n","An object with additional options for the ",(0,o.jsx)(n.code,{children:"ClsInterceptor"}),", see ",(0,o.jsx)(n.a,{href:"#middleware--enhancer-options",children:"below"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"global?:"})})}),(0,o.jsx)(n.code,{children:"boolean"}),"** (default ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"false"})}),")",(0,o.jsx)(n.br,{}),"\n","Whether to make the module global, so you do not have to import ",(0,o.jsx)(n.code,{children:"ClsModule.forFeature()"})," in other modules."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"proxyProviders?:"})})}),(0,o.jsx)(n.code,{children:"Type[]"}),(0,o.jsx)(n.br,{}),"\n","Array of ",(0,o.jsx)(n.a,{href:"/nestjs-cls/features-and-use-cases/proxy-providers",children:"Proxy Providers"})," that should be registered in the root module. Currently only accepts sync class Proxy providers, use ",(0,o.jsx)(n.code,{children:"ClsModule.forFeatureAsync()"})," for more complex use-cases."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"ClsModule.forRootAsync()"})," is also available. You can supply the usual ",(0,o.jsx)(n.code,{children:"imports"}),", ",(0,o.jsx)(n.code,{children:"inject"})," and ",(0,o.jsx)(n.code,{children:"useFactory"})," parameters as usual."]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Please note"}),": If you intend to use multiple enhancers at the same time (e.g. initialize the CLS context in a middleware and then set some additional CLS variables in an interceptor), be aware that the only the first one in the chain will set the Request ID."]})}),"\n",(0,o.jsx)(n.h2,{id:"forfeatureasync",children:"forFeature(Async)"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"ClsModule.forFeature()"})," method can be used to register a ",(0,o.jsx)(n.a,{href:"/nestjs-cls/features-and-use-cases/proxy-providers",children:"Proxy Providers"}),". The Sync method only accepts Class Proxy providers."]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"ClsModule.forFeatureAsync()"})," method accepts either ",(0,o.jsx)(n.code,{children:"ClsModuleProxyClassProviderOptions"})," or ",(0,o.jsx)(n.code,{children:"ClsModuleProxyFactoryProviderOptions"})," that both accept these options:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"provide?:"})})}),(0,o.jsx)(n.code,{children:"any"}),(0,o.jsx)(n.br,{}),"\n","Custom injection token to use for the provider. In case of a class provider, this parameter is optional, as the class reference passed to ",(0,o.jsx)(n.code,{children:"useClass"})," will be used by default."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"imports?"})})}),(0,o.jsx)(n.code,{children:"any[]"}),(0,o.jsx)(n.br,{}),"\n","Optional list of imported modules that export the providers which are required for the provider."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"extraProviders?:"})})}),(0,o.jsx)(n.code,{children:"Provider[]"}),(0,o.jsx)(n.br,{}),"\n","Optional list of additional providers that should be available to the Proxy. Useful for passing configuration from a parent dynamic module."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"ClsModuleProxyClassProviderOptions"})," interface further accepts:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"useClass:"})})}),(0,o.jsx)(n.code,{children:"Type"}),(0,o.jsx)(n.br,{}),"\n","The target class that will be used by this Proxy Provider. Make sure it is decorated with ",(0,o.jsx)(n.code,{children:"@InjectableProxy"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"ClsModuleProxyFactoryProviderOptions"})," interface further accepts:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"inject:"})})}),(0,o.jsx)(n.code,{children:"any[]"}),(0,o.jsx)(n.br,{}),"\n","An array of injection tokens for providers used in the ",(0,o.jsx)(n.code,{children:"useFactory"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"useFactory:"})})}),(0,o.jsx)(n.code,{children:"(...args: any[]) => any"}),(0,o.jsx)(n.br,{}),"\n","Factory function that accepts an array of providers in the order of the according tokens in the ",(0,o.jsx)(n.code,{children:"inject"})," array. Returns (or resolves with) an object (or a function) that will be used by this Proxy Provider."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"type?:"})})}),(0,o.jsx)(n.code,{children:"'function' | 'object'"}),(0,o.jsx)(n.br,{}),"\n","Whether the Proxy Provider should be a function or an object. Defaults to ",(0,o.jsx)(n.code,{children:"'object'"}),". See ",(0,o.jsx)(n.a,{href:"/nestjs-cls/features-and-use-cases/proxy-providers#caveats",children:"Caveats"})," for more information."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"strict?:"})})}),(0,o.jsx)(n.code,{children:"boolean"}),(0,o.jsx)(n.br,{}),"\n","Whether to register this Proxy Provider in ",(0,o.jsx)(n.a,{href:"/nestjs-cls/features-and-use-cases/proxy-providers#strict-proxy-providers",children:"strict mode"}),". Defaults to ",(0,o.jsx)(n.code,{children:"false"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"middleware--enhancer-options",children:"Middleware & Enhancer options"}),"\n",(0,o.jsxs)(n.p,{children:["All of the ",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"Cls{Middleware,Guard,Interceptor}Options"})})," take the following parameters (either in ",(0,o.jsx)(n.code,{children:"ClsModuleOptions"})," or directly when instantiating them manually):"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"mount?:"})})}),(0,o.jsx)(n.code,{children:"boolean"})," (default ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"false"})}),")",(0,o.jsx)(n.br,{}),"\n","Whether to automatically mount the middleware/guard/interceptor to every route (not applicable when instantiating them manually)"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"generateId?:"})})}),(0,o.jsx)(n.code,{children:"boolean"})," (default ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"false"})}),")",(0,o.jsx)(n.br,{}),"\n","Whether to automatically generate a request ID. It will be available under the ",(0,o.jsx)(n.code,{children:"CLS_ID"})," key."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"idGenerator?:"})})}),(0,o.jsx)(n.code,{children:"(req: Request) => string | Promise<string>"}),(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"idGenerator?:"})})}),(0,o.jsx)(n.code,{children:"(ctx: ExecutionContext) => string | Promise<string>"}),(0,o.jsx)(n.br,{}),"\n","An optional function for generating the request ID. It takes the ",(0,o.jsx)(n.code,{children:"Request"})," object (or the ",(0,o.jsx)(n.code,{children:"ExecutionContext"})," in case of a Guard or Interceptor) as an argument and (synchronously or asynchronously) returns a string. The default implementation uses ",(0,o.jsx)(n.code,{children:"Math.random()"})," to generate a string of 8 characters."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"setup?:"})})}),(0,o.jsx)(n.code,{children:"(cls: ClsService, req: Request) => void | Promise<void>;"}),(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"setup?:"})})}),(0,o.jsx)(n.code,{children:"(cls: ClsService, ctx: ExecutionContext) => void | Promise<void>;"}),(0,o.jsx)(n.br,{}),"\n","Function that executes after the CLS context had been initialised. It can be used to put additional variables in the CLS context."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"resolveProxyProviders?:"})})}),(0,o.jsx)(n.code,{children:"boolean"})," (default ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"true"})}),")",(0,o.jsx)(n.br,{}),"\n","Whether to automatically resolve Proxy Providers in the enhancer (if any are registered)."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"initializePlugins?:"})})}),(0,o.jsx)(n.code,{children:"boolean"})," (default ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"true"})}),")",(0,o.jsx)(n.br,{}),"\n","Whether to run the initialization hooks for plugins as a part of the CLS context registration."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"ClsMiddlewareOptions"})," additionally takes the following parameters:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"saveReq?:"})})}),(0,o.jsx)(n.code,{children:"boolean"})," (default ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"true"})}),")",(0,o.jsx)(n.br,{}),"\n","Whether to store the ",(0,o.jsx)(n.em,{children:"Request"})," object to the context. It will be available under the ",(0,o.jsx)(n.code,{children:"CLS_REQ"})," key."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"saveRes?:"})})}),(0,o.jsx)(n.code,{children:"boolean"})," (default ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"false"})}),")",(0,o.jsx)(n.br,{}),"\n","Whether to store the ",(0,o.jsx)(n.em,{children:"Response"})," object to the context. It will be available under the ",(0,o.jsx)(n.code,{children:"CLS_RES"})," key"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"useEnterWith?:"})})}),(0,o.jsx)(n.code,{children:"boolean"})," (default ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"false"})}),")",(0,o.jsx)(n.br,{}),"\n","Set to ",(0,o.jsx)(n.code,{children:"true"})," to set up the context using a call to ",(0,o.jsx)(n.a,{href:"https://nodejs.org/api/async_context.html#async_context_asynclocalstorage_enterwith_store",children:(0,o.jsx)(n.code,{children:"AsyncLocalStorage#enterWith"})})," instead of wrapping the ",(0,o.jsx)(n.code,{children:"next()"})," call with the safer ",(0,o.jsx)(n.a,{href:"https://nodejs.org/api/async_context.html#async_context_asynclocalstorage_run_store_callback_args",children:(0,o.jsx)(n.code,{children:"AsyncLocalStorage#run"})}),". Most of the time this should not be necessary, but ",(0,o.jsx)(n.a,{href:"/nestjs-cls/considerations/compatibility#graphql",children:"some frameworks"})," have been known to lose the context with ",(0,o.jsx)(n.code,{children:"run"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"Cls{Guard,Interceptor}Options"})," additionally takes the following parameters:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"saveCtx?:"})})}),(0,o.jsx)(n.code,{children:"boolean"})," (default ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"true"})}),") ",(0,o.jsxs)("small",{children:["Since ",(0,o.jsx)(n.code,{children:"v5.1.0"})]}),(0,o.jsx)(n.br,{}),"\n","Whether to store the ",(0,o.jsx)(n.em,{children:"ExecutionContext"})," object to the context. It will be available under the ",(0,o.jsx)(n.code,{children:"CLS_CTX"})," key."]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},3023:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var r=s(3696);const o={},i=r.createContext(o);function t(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);